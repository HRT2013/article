<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HRT's Wiki</title>
    <link rel="icon" href="https://cdn.luogu.com.cn/upload/usericon/1057417.png" type="image/png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-light.min.css" id="hljs-theme">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">

    <style>
        :root {
            /* Apple Light Mode */
            --bg-body: #ffffff;
            --bg-sidebar: #f5f5f7;
            --bg-card: #ffffff;
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --accent: #0066cc; /* Apple Blue */
            --border: #d2d2d7;
            --divider: #e5e5ea;
            --glass: rgba(255, 255, 255, 0.8);
            
            /* 组件颜色 */
            --code-bg: #f5f5f7;
            --nav-hover: rgba(0,0,0,0.05);
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            
            /* Admonition Colors */
            --adm-note: #0066cc;
            --adm-warn: #ff9500;
            --adm-danger: #ff3b30;
            
            --header-h: 52px;
            --sidebar-w: 260px;
            --toc-w: 240px;
        }

        [data-theme="dark"] {
            /* Apple Dark Mode */
            --bg-body: #000000;
            --bg-sidebar: #1c1c1e;
            --bg-card: #1c1c1e;
            --text-primary: #f5f5f7;
            --text-secondary: #86868b;
            --accent: #2997ff;
            --border: #424245;
            --divider: #38383a;
            --glass: rgba(28, 28, 30, 0.8);
            
            --code-bg: #2c2c2e;
            --nav-hover: rgba(255,255,255,0.1);
            --shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Helvetica, Arial, sans-serif;
            background: var(--bg-body);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background 0.3s, color 0.3s;
            overflow-y: scroll; /* 防止滚动条跳动 */
        }

        /* --- 顶部磨砂导航栏 --- */
        .header {
            position: fixed; top: 0; width: 100%; height: var(--header-h);
            background: var(--glass);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid var(--divider);
            z-index: 1000;
            display: flex; align-items: center; padding: 0 24px;
            transition: border-color 0.3s;
        }
        .header-inner { max-width: 1400px; margin: 0 auto; width: 100%; display: flex; align-items: center; justify-content: space-between; }
        .logo { font-weight: 600; font-size: 1.1rem; letter-spacing: -0.01em; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        
        .header-controls { display: flex; gap: 16px; align-items: center; }
        .icon-btn { cursor: pointer; font-size: 1.1rem; color: var(--text-primary); opacity: 0.8; transition: 0.2s; background: none; border: none; }
        .icon-btn:hover { opacity: 1; color: var(--accent); }

        /* --- 布局容器 --- */
        .layout {
            display: grid;
            grid-template-columns: var(--sidebar-w) 1fr var(--toc-w);
            max-width: 1400px;
            margin: var(--header-h) auto 0;
            min-height: calc(100vh - var(--header-h));
        }

        /* 左侧导航 */
        .sidebar {
            position: sticky; top: var(--header-h); height: calc(100vh - var(--header-h));
            overflow-y: auto; padding: 30px 20px;
            border-right: 1px solid var(--divider);
            background: var(--bg-body); /* 在大屏模式下保持与背景一致更像Apple */
        }
        .nav-group-title { font-size: 0.75rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin: 20px 0 10px 10px; }
        .nav-item {
            display: block; padding: 8px 12px; border-radius: 8px;
            color: var(--text-primary); text-decoration: none; font-size: 0.9rem; font-weight: 500;
            transition: 0.2s; cursor: pointer; margin-bottom: 2px;
        }
        .nav-item:hover { background: var(--nav-hover); }
        .nav-item.active { background: var(--nav-hover); color: var(--accent); }

        /* 中间内容区 */
        .main-content { padding: 40px 60px; min-width: 0; }
        
        /* 右侧大纲 (TOC) */
        .toc-sidebar {
            position: sticky; top: var(--header-h); height: calc(100vh - var(--header-h));
            overflow-y: auto; padding: 40px 20px;
            border-left: 1px solid transparent; /* 视觉上更干净 */
        }
        .toc-title { font-size: 0.75rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 15px; text-transform: uppercase; }
        .toc-list { list-style: none; position: relative; }
        .toc-list li { margin-bottom: 8px; }
        .toc-link {
            display: block; text-decoration: none; color: var(--text-secondary);
            font-size: 0.85rem; padding-left: 10px; border-left: 2px solid var(--divider);
            transition: 0.2s; line-height: 1.4;
        }
        .toc-link:hover { color: var(--text-primary); }
        .toc-link.active { color: var(--accent); border-left-color: var(--accent); font-weight: 500; }
        .toc-link.h3 { padding-left: 24px; font-size: 0.8rem; }

        /* --- 文章排版 (Apple Style) --- */
        h1 { font-size: 2.5rem; font-weight: 700; letter-spacing: -0.02em; margin-bottom: 0.5em; line-height: 1.1; }
        h2 { font-size: 1.8rem; font-weight: 600; letter-spacing: -0.015em; margin: 2em 0 0.8em; padding-bottom: 0.3em; border-bottom: 1px solid var(--divider); scroll-margin-top: 80px; }
        h3 { font-size: 1.4rem; font-weight: 600; margin: 1.5em 0 0.8em; scroll-margin-top: 80px; }
        p { margin-bottom: 1.2em; font-size: 1.05rem; font-weight: 400; color: var(--text-primary); opacity: 0.95; }
        code { font-family: "SF Mono", SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace; font-size: 0.9em; background: var(--nav-hover); padding: 2px 6px; border-radius: 6px; color: var(--accent); }
        pre { background: var(--code-bg); padding: 20px; border-radius: 12px; overflow-x: auto; margin: 1.5em 0; border: 1px solid var(--divider); }
        pre code { background: transparent; padding: 0; color: inherit; }
        blockquote { border-left: 4px solid var(--accent); margin: 1.5em 0; padding-left: 1em; color: var(--text-secondary); font-style: italic; }
        img { max-width: 100%; border-radius: 12px; box-shadow: var(--shadow); margin: 1em 0; }

        /* --- 组件: 折叠框 (Admonition) --- */
        .admonition {
            margin: 1.5em 0; border-radius: 12px; overflow: hidden;
            border: 1px solid var(--divider); background: var(--bg-card);
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        }
        .admonition-title {
            padding: 12px 16px; font-weight: 600; font-size: 0.95rem;
            display: flex; align-items: center; cursor: pointer; user-select: none;
            background: var(--nav-hover); border-bottom: 1px solid var(--divider);
        }
        .admonition-title i { margin-right: 10px; }
        .admonition-title::after { content: "\f078"; font-family: "Font Awesome 6 Free"; margin-left: auto; transition: 0.3s; font-size: 0.8em; opacity: 0.5; }
        .admonition.collapsed .admonition-title::after { transform: rotate(-90deg); }
        .admonition-content { padding: 20px; }
        .admonition.collapsed .admonition-content { display: none; }

        /* 颜色变体 */
        .admonition.note .admonition-title { color: var(--adm-note); }
        .admonition.warning .admonition-title { color: var(--adm-warn); }
        .admonition.danger .admonition-title { color: var(--adm-danger); }

        /* --- 组件: 选项卡 (Tabs) --- */
        .tab-group { margin: 1.5em 0; border: 1px solid var(--divider); border-radius: 12px; overflow: hidden; background: var(--bg-card); }
        .tab-labels { display: flex; background: var(--nav-hover); border-bottom: 1px solid var(--divider); padding: 0 4px; }
        .tab-label {
            padding: 10px 20px; cursor: pointer; font-size: 0.9rem; font-weight: 500; color: var(--text-secondary);
            position: relative; transition: 0.2s;
        }
        .tab-label:hover { color: var(--text-primary); }
        .tab-label.active { color: var(--text-primary); }
        .tab-label.active::after {
            content: ''; position: absolute; bottom: -1px; left: 0; width: 100%; height: 2px;
            background: var(--accent); border-radius: 2px 2px 0 0;
        }
        .tab-content { display: none; padding: 20px; animation: fadeSafe 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeSafe { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* 编辑器 */
        .editor-wrap { max-width: 800px; margin: 0 auto; }
        .input-title { width: 100%; font-size: 2rem; border: none; background: transparent; color: var(--text-primary); font-weight: 700; margin-bottom: 20px; font-family: inherit; }
        .input-title::placeholder { color: var(--text-secondary); opacity: 0.5; }
        .input-md { width: 100%; min-height: 60vh; border: none; background: transparent; color: var(--text-primary); resize: none; font-family: "SF Mono", monospace; font-size: 1rem; line-height: 1.6; }
        
        .btn { padding: 8px 20px; border-radius: 20px; border: none; font-size: 0.9rem; font-weight: 500; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { opacity: 0.9; transform: scale(1.02); }
        .btn-ghost { background: transparent; color: var(--text-secondary); }
        .btn-ghost:hover { color: var(--text-primary); background: var(--nav-hover); }

        /* 响应式 */
        @media (max-width: 1100px) {
            .toc-sidebar { display: none; }
            .layout { grid-template-columns: var(--sidebar-w) 1fr; }
        }
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .layout { grid-template-columns: 1fr; }
            .main-content { padding: 30px 20px; }
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="header-inner">
            <div class="logo" onclick="Router.go('/')">
                <i class="fab fa-apple"></i> HRT's HRT's HRT's HRT's Wiki
            </div>
            <div class="header-controls">
                <button class="icon-btn" onclick="toggleTheme()" title="切换深色模式">
                    <i class="fas fa-moon" id="theme-icon"></i>
                </button>
                <div id="auth-box"></div>
            </div>
        </div>
    </header>

    <div class="layout">
        <aside class="sidebar" id="sidebar-nav"></aside>
        <main class="main-content" id="view-area"></main>
        <aside class="toc-sidebar">
            <div class="toc-title">ON THIS PAGE</div>
            <ul class="toc-list" id="toc-list"></ul>
        </aside>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <script>
        // --- 1. 系统设置：深色模式 ---
        function initTheme() {
            const saved = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', saved);
            updateThemeIcon(saved);
            updateHljsTheme(saved);
        }

        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const target = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', target);
            localStorage.setItem('theme', target);
            updateThemeIcon(target);
            updateHljsTheme(target);
        }

        function updateThemeIcon(theme) {
            const icon = document.getElementById('theme-icon');
            icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        function updateHljsTheme(theme) {
            const link = document.getElementById('hljs-theme');
            if (theme === 'dark') {
                link.href = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css";
            } else {
                link.href = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-light.min.css";
            }
        }
        initTheme();

        // --- 2. Supabase ---
        const CONFIG = {
            URL: 'https://qalinnggueysnsfrmoux.supabase.co',
            KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhbGlubmdndWV5c25zZnJtb3V4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2ODUwNjgsImV4cCI6MjA4NjI2MTA2OH0.rlngJnOtXVs-Q1qXxN8iSrTCbjslJu0K_qouVsgOfj0'
        };
        const db = window.supabase.createClient(CONFIG.URL, CONFIG.KEY);
        let currentUser = null, allArticles = [];

        // --- 3. 核心：递归分治渲染器 (保持之前的逻辑以完美支持折叠) ---
        function parseAndRender(markdown) {
            if (!markdown) return '';
            const lines = markdown.split('\n');
            let resultHTML = '', buffer = [];

            const flushBuffer = () => {
                if (buffer.length) { resultHTML += marked.parse(buffer.join('\n')); buffer = []; }
            };

            for (let i = 0; i < lines.length; i++) {
                let line = lines[i];
                const indent = line.search(/\S|$/);
                
                const admMatch = line.match(/^(\?{3}\+?)\s+(\w+)(?:\s+"([^"]+)")?/);
                const tabMatch = line.match(/^===\s+"([^"]+)"/);

                if (admMatch) {
                    flushBuffer();
                    let blockLines = [], baseIndent = -1;
                    i++;
                    while (i < lines.length) {
                        const nextLine = lines[i], nextIndent = nextLine.search(/\S|$/);
                        if (!nextLine.trim()) { blockLines.push(''); i++; continue; }
                        if (baseIndent === -1) baseIndent = nextIndent;
                        if (nextIndent < baseIndent) { i--; break; }
                        blockLines.push(nextLine.substring(baseIndent));
                        i++;
                    }
                    const innerHTML = parseAndRender(blockLines.join('\n'));
                    const [_, sym, type, title] = admMatch;
                    const isCollapsed = !sym.includes('+');
                    const displayTitle = title || type.toUpperCase();
                    let icon = 'fa-info-circle';
                    if (type === 'warning') icon = 'fa-exclamation-triangle';
                    if (type === 'danger') icon = 'fa-bolt';

                    resultHTML += `<div class="admonition ${type} ${isCollapsed ? 'collapsed' : ''}"><div class="admonition-title" onclick="this.parentElement.classList.toggle('collapsed')"><i class="fas ${icon}"></i>${displayTitle}</div><div class="admonition-content">${innerHTML}</div></div>`;
                } 
                else if (tabMatch) {
                    flushBuffer();
                    let tabs = [];
                    i--;
                    while (i + 1 < lines.length) {
                        const nextHeader = lines[i+1];
                        const nextMatch = nextHeader.match(/^===\s+"([^"]+)"/);
                        if (!nextMatch) break;
                        i++;
                        const tabTitle = nextMatch[1];
                        let tabContent = [], tabBaseIndent = -1;
                        i++;
                        while(i < lines.length) {
                            const nl = lines[i], ni = nl.search(/\S|$/);
                            if(!nl.trim()) { tabContent.push(''); i++; continue; }
                            if(tabBaseIndent === -1) tabBaseIndent = ni;
                            if(ni < tabBaseIndent) { i--; break; }
                            tabContent.push(nl.substring(tabBaseIndent));
                            i++;
                        }
                        tabs.push({title: tabTitle, content: tabContent.join('\n')});
                    }
                    if(tabs.length) {
                        const uid = Math.random().toString(36).substr(2, 6);
                        let lbls = '', panes = '';
                        tabs.forEach((t, idx) => {
                            const active = idx===0?'active':'';
                            lbls += `<div class="tab-label ${active}" onclick="switchTab('${uid}', ${idx})">${t.title}</div>`;
                            panes += `<div class="tab-content ${active}" data-idx="${idx}">${parseAndRender(t.content)}</div>`;
                        });
                        resultHTML += `<div class="tab-group" id="tab-${uid}"><div class="tab-labels">${lbls}</div>${panes}</div>`;
                    }
                } else {
                    buffer.push(line);
                }
            }
            flushBuffer();
            return resultHTML;
        }

        window.switchTab = (uid, idx) => {
            const g = document.getElementById(`tab-${uid}`);
            g.querySelectorAll('.tab-label').forEach((el, i) => el.classList.toggle('active', i===idx));
            g.querySelectorAll('.tab-content').forEach((el, i) => el.classList.toggle('active', i===idx));
        };

        // --- 4. 功能：生成大纲 (TOC) ---
        function generateTOC() {
            const root = document.getElementById('md-root');
            const headers = root.querySelectorAll('h2, h3');
            const list = document.getElementById('toc-list');
            list.innerHTML = '';

            if (headers.length === 0) {
                list.innerHTML = '<li style="color:var(--text-secondary);font-size:0.8rem">暂无目录</li>';
                return;
            }

            headers.forEach((header, index) => {
                const id = 'heading-' + index;
                header.id = id;
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.className = `toc-link ${header.tagName.toLowerCase()}`;
                a.href = '#' + id;
                a.innerText = header.innerText;
                a.onclick = (e) => {
                    e.preventDefault();
                    document.getElementById(id).scrollIntoView({behavior: 'smooth'});
                    history.pushState(null, null, '#' + id);
                };
                li.appendChild(a);
                list.appendChild(li);
            });

            // ScrollSpy
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        document.querySelectorAll('.toc-link').forEach(l => l.classList.remove('active'));
                        const activeLink = document.querySelector(`.toc-link[href="#${entry.target.id}"]`);
                        if(activeLink) activeLink.classList.add('active');
                    }
                });
            }, { rootMargin: '-100px 0px -60% 0px' });
            headers.forEach(h => observer.observe(h));
        }

        // --- 5. 页面渲染 ---
        const Router = {
            get() {
                const p = window.location.pathname;
                return { id: p.match(/\/article\/([^/]+)/)?.[1], isNew: p.endsWith('/new'), isEdit: p.endsWith('/edit') };
            },
            go(path) { window.history.pushState(null, '', path); this.handle(); },
            handle() {
                const p = this.get();
                // 重置视图
                document.querySelector('.toc-sidebar').style.display = (p.isNew || p.isEdit) ? 'none' : 'block';
                
                if (p.isNew) renderEditor();
                else if (p.id && p.isEdit) renderEditor(p.id);
                else if (p.id) showDetail(p.id);
                else renderHome();
                renderSidebar();
            }
        };

        async function showDetail(id) {
            const art = allArticles.find(a => a.id == id);
            const container = document.getElementById('view-area');
            if (!art) return container.innerHTML = "<h1>404</h1><p>页面未找到</p>";

            const htmlContent = parseAndRender(art.md || '');

            container.innerHTML = `
                <div style="margin-bottom:20px">
                    <h1>${escapeHtml(art.title)}</h1>
                    <div style="font-size:0.9rem; color:var(--text-secondary);">
                        ${new Date(art.created_at).toLocaleDateString()} 
                        ${currentUser ? ` · <a href="javascript:Router.go('/article/${id}/edit')" style="color:var(--accent)">编辑</a>` : ''}
                    </div>
                </div>
                <div id="md-root">${htmlContent}</div>
            `;

            const root = document.getElementById('md-root');
            renderMathInElement(root, { delimiters: [{left: "$$", right: "$$", display: true}, {left: "$", right: "$", display: false}] });
            root.querySelectorAll('pre code').forEach(el => hljs.highlightElement(el));
            
            generateTOC();
            window.scrollTo(0, 0);
        }

        async function renderEditor(id=null) {
            if (!currentUser) return Router.go('/');
            const art = id ? allArticles.find(a => a.id == id) : { title: '', md: '' };
            document.getElementById('view-area').innerHTML = `
                <div class="editor-wrap">
                    <input id="ed-title" class="input-title" value="${escapeHtml(art.title)}" placeholder="在此输入标题">
                    <textarea id="ed-md" class="input-md" placeholder="开始写作... (支持 Markdown, LaTeX, 折叠块, 选项卡)">${art.md}</textarea>
                    <div style="margin-top:20px; display:flex; gap:10px;">
                        <button class="btn btn-primary" onclick="saveArt('${id||''}')">发布文章</button>
                        <button class="btn btn-ghost" onclick="Router.go('/')">取消</button>
                    </div>
                </div>`;
            document.getElementById('toc-list').innerHTML = ''; // 清空目录
        }

        // --- 6. 数据与侧边栏 ---
        async function fetchArticles() {
            const { data } = await db.from('article').select('*').order('created_at', { ascending: false });
            allArticles = data || [];
        }

        function renderSidebar() {
            const nav = document.getElementById('sidebar-nav');
            const cur = Router.get().id;
            let h = `<div class="nav-group-title">Menu</div>`;
            h += `<a class="nav-item ${!cur?'active':''}" onclick="Router.go('/')"><i class="fas fa-home" style="width:20px"></i> 首页</a>`;
            if (currentUser) h += `<a class="nav-item" onclick="Router.go('/article/new')"><i class="fas fa-plus" style="width:20px"></i> 新建文章</a>`;
            h += `<div class="nav-group-title">Library</div>`;
            allArticles.filter(a => a.id !== 'home').forEach(a => {
                h += `<a class="nav-item ${cur==a.id?'active':''}" onclick="Router.go('/article/${a.id}')">${escapeHtml(a.title)}</a>`;
            });
            nav.innerHTML = h;
        }

        async function saveArt(id) {
            const title = document.getElementById('ed-title').value;
            const md = document.getElementById('ed-md').value;
            const finalId = id || Math.random().toString(36).substr(2, 10);
            const payload = { id: finalId, title, md, updated_at: new Date() };
            const { error } = id ? await db.from('article').update(payload).eq('id', id) : await db.from('article').insert([payload]);
            if (error) alert(error.message); else { await fetchArticles(); Router.go(finalId==='home'?'/':`/article/${finalId}`); }
        }

        // --- 7. 认证与初始化 ---
        async function checkAuth() {
            const { data } = await db.auth.getSession();
            currentUser = data.session?.user;
            document.getElementById('auth-box').innerHTML = currentUser ? 
                `<button class="btn btn-ghost" onclick="db.auth.signOut().then(()=>location.reload())" style="font-size:0.85rem">退出</button>` : 
                `<button class="btn btn-primary" onclick="login()" style="padding:6px 16px; border-radius:16px;">登录</button>`;
        }
        async function renderHome() {
            const home = allArticles.find(a => a.id === 'home');
            home ? showDetail('home') : document.getElementById('view-area').innerHTML = '<div style="text-align:center; padding:50px"><h1>Welcome</h1><p>HRT's HRT's HRT's Wiki 已准备就绪</p>' + (currentUser ? '<button class="btn btn-primary" onclick="initHome()">初始化首页</button>' : '') + '</div>';
        }
        async function initHome() { await db.from('article').insert([{ id: 'home', title: '首页', md: '???+ note "Welcome"\n    Hello World!', created_at: new Date() }]); await fetchArticles(); Router.handle(); }
        async function login() { const e=prompt("Email"), p=prompt("Password"); if(e&&p) await db.auth.signInWithPassword({email:e,password:p}).then(()=>location.reload()); }
        function escapeHtml(s) { const d = document.createElement('div'); d.innerText = s; return d.innerHTML; }

        window.onload = async () => { await checkAuth(); await fetchArticles(); Router.handle(); };
        window.onpopstate = () => Router.handle();
    </script>
</body>
</html>
